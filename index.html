<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <meta name="author" content="Theodore Beers" />
    <meta name="dcterms.date" content="2025-07-14" />
    <title>Unicode Collation for Dummies</title>
    <style>
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      div.columns {
        display: flex;
        gap: min(4vw, 1.5em);
      }
      div.column {
        flex: auto;
        overflow-x: auto;
      }
      div.hanging-indent {
        margin-left: 1.5em;
        text-indent: -1.5em;
      }
      /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
      ul.task-list[class] {
        list-style: none;
      }
      ul.task-list li input[type="checkbox"] {
        font-size: inherit;
        width: 0.8em;
        margin: 0 0.8em 0.2em -1.6em;
        vertical-align: middle;
      }
      .display.math {
        display: block;
        text-align: center;
        margin: 0.5rem auto;
      }
      /* CSS for syntax highlighting */
      html {
        -webkit-text-size-adjust: 100%;
      }
      pre > code.sourceCode {
        white-space: pre;
        position: relative;
      }
      pre > code.sourceCode > span {
        display: inline-block;
        line-height: 1.25;
      }
      pre > code.sourceCode > span:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode > span {
        color: inherit;
        text-decoration: inherit;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        pre > code.sourceCode {
          white-space: pre-wrap;
        }
        pre > code.sourceCode > span {
          text-indent: -5em;
          padding-left: 5em;
        }
      }
      pre.numberSource code {
        counter-reset: source-line 0;
      }
      pre.numberSource code > span {
        position: relative;
        left: -4em;
        counter-increment: source-line;
      }
      pre.numberSource code > span > a:first-child::before {
        content: counter(source-line);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        background-color: #232629;
        color: #7a7c7d;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #7a7c7d;
        padding-left: 4px;
      }
      div.sourceCode {
        color: #cfcfc2;
        background-color: #232629;
      }
      @media screen {
        pre > code.sourceCode > span > a:first-child::before {
          text-decoration: underline;
        }
      }
      code span {
        color: #cfcfc2;
      } /* Normal */
      code span.al {
        color: #95da4c;
        background-color: #4d1f24;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #3f8058;
      } /* Annotation */
      code span.at {
        color: #2980b9;
      } /* Attribute */
      code span.bn {
        color: #f67400;
      } /* BaseN */
      code span.bu {
        color: #7f8c8d;
      } /* BuiltIn */
      code span.cf {
        color: #fdbc4b;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #3daee9;
      } /* Char */
      code span.cn {
        color: #27aeae;
        font-weight: bold;
      } /* Constant */
      code span.co {
        color: #7a7c7d;
      } /* Comment */
      code span.cv {
        color: #7f8c8d;
      } /* CommentVar */
      code span.do {
        color: #a43340;
      } /* Documentation */
      code span.dt {
        color: #2980b9;
      } /* DataType */
      code span.dv {
        color: #f67400;
      } /* DecVal */
      code span.er {
        color: #da4453;
        text-decoration: underline;
      } /* Error */
      code span.ex {
        color: #0099ff;
        font-weight: bold;
      } /* Extension */
      code span.fl {
        color: #f67400;
      } /* Float */
      code span.fu {
        color: #8e44ad;
      } /* Function */
      code span.im {
        color: #27ae60;
      } /* Import */
      code span.in {
        color: #c45b00;
      } /* Information */
      code span.kw {
        color: #cfcfc2;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #cfcfc2;
      } /* Operator */
      code span.ot {
        color: #27ae60;
      } /* Other */
      code span.pp {
        color: #27ae60;
      } /* Preprocessor */
      code span.re {
        color: #2980b9;
        background-color: #153042;
      } /* RegionMarker */
      code span.sc {
        color: #3daee9;
      } /* SpecialChar */
      code span.ss {
        color: #da4453;
      } /* SpecialString */
      code span.st {
        color: #f44f4f;
      } /* String */
      code span.va {
        color: #27aeae;
      } /* Variable */
      code span.vs {
        color: #da4453;
      } /* VerbatimString */
      code span.wa {
        color: #da4453;
      } /* Warning */
    </style>
    <link rel="stylesheet" href="reset.css" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Merriweather:ital,opsz,wght@0,18..144,300..900;1,18..144,300..900&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <header id="title-block-header">
      <h1 class="title">Unicode Collation for Dummies</h1>
      <p class="author">Theodore Beers</p>
      <p class="date">14 July 2025</p>
    </header>
    <p>
      This post is meant as an introduction to the
      <a href="https://www.unicode.org/reports/tr10/"
        >Unicode Collation Algorithm</a
      >
      (UCA), a standardized solution to a problem that turns out to be
      surprisingly complex: how can we alphabetically sort items of text when
      the characters go beyond the basic Latin alphabet? Let’s find out…
    </p>
    <p>
      <em
        >Sidebar: I maintain a simple but conformant &amp; performant
        implementation of the UCA in Rust, called
        <a href="https://github.com/theodore-s-beers/feruca">feruca</a> ; and I
        recently adapted it to Zig, in a library called
        <a href="https://github.com/theodore-s-beers/later">later</a> . Code
        examples in this post will be in Zig. You may also like to visit my “<a
          href="https://www.theobeers.com/allsorts/"
          >Text Sorting Playground</a
        > ,” a little web app that demonstrates the differences among a few
        approaches to collation.</em
      >
    </p>
    <h2 id="introduction">Introduction</h2>
    <p>
      Given two strings of UTF-8-endoded text—let’s say, for example, the names
      “Ernie” and “Frank”—it is trivial for a computer to determine which of
      them should come first alphabetically. If we look at a representation of
      those strings as arrays of byte values, we find that “Ernie” is (in
      hexadecimal) <code>[45, 72, 6E, 69, 65]</code>; and “Frank” is
      <code>[46, 72, 61, 6E, 6B]</code>. Simple array comparison yields a
      difference at index 0, with E being “less than” F, so that Ernie sorts
      before Frank. This is a happy consequence of the fact that early text
      encoding schemes—notably ASCII, which was inherited by Unicode—assigned
      numerical values to the letters that they included in
      <em>a kind of</em> alphabetical order. There is still the issue that ASCII
      groups all the uppercase letters before all the lowercase letters, so
      that, for example, “earnest” will sort after “Frank.” But at least we have
      an alphabetical order of byte values within the uppercase and lowercase
      groups.
    </p>
    <p>
      Back to the larger problem: what happens if we add, say, “Élodie” to our
      list of names? A human will understand intuitively that E and É belong
      together as variants of the same letter—perhaps with the accented version
      to come after the unaccented, alphabetically. But how can we establish
      this rigorously in a way that facilitates automated sorting? The letter É
      has two main representations in Unicode: either as a single character,
      <code>U+00C9</code>, for a Latin capital E with an acute accent; or as a
      combination of two characters, <code>U+0045</code> and
      <code>U+0301</code>, accounting for the base letter and the accent,
      respectively. (I wanted to bring up the “decomposed representation” as
      early as possible in this post, since that is the form that we generally
      want for Unicode sorting/collation. More on this later…)
    </p>
    <p>
      Both of these representations will break the naïve approach to sorting, in
      their own ways. <code>C9</code> as a byte value is greater than any in the
      ASCII/Basic Latin table, meaning that “Élodie” would sort after, say,
      “Zoë.” Using the decomposed form seems promising—the first byte value is
      simply that of E, appropriate for sorting—but the combining accent
      character introduces new problems. <code>0x301</code>
      is too large to be represented in a single byte, so in UTF-8 it becomes
      <code>[CC, 81]</code>. “Élodie” in decomposed form is made up of seven
      code points, in eight bytes in the common encoding, where we perceive only
      six letters. It should be obvious how this would wreak havoc on a sorting
      algorithm that does nothing more than array comparison on the byte values.
    </p>
    <p>
      We need something better. Unicode is a large and complex system, and if we
      want a way of associating code points with collation weights, it will have
      to be defined explicitly. That’s where the Unicode Collation Algorithm
      comes in.
    </p>
    <p>Testing Zig syntax highlighting:</p>
    <div class="sourceCode" id="cb1">
      <pre
        class="sourceCode zig"
      ><code class="sourceCode zig"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">test</span> <span class="st">&quot;sort multilingual list of names&quot;</span> {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> alloc <span class="op">=</span> std<span class="op">.</span>testing<span class="op">.</span>allocator;</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">var</span> coll <span class="op">=</span> <span class="cf">try</span> Collator<span class="op">.</span>initDefault(alloc);</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">defer</span> coll<span class="op">.</span>deinit();</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">var</span> input <span class="op">=</span> [_][]<span class="at">const</span> <span class="dt">u8</span>{</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;چنگیز&quot;</span><span class="op">,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Éloi&quot;</span><span class="op">,</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Ötzi&quot;</span><span class="op">,</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Melissa&quot;</span><span class="op">,</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;صدام&quot;</span><span class="op">,</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Mélissa&quot;</span><span class="op">,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Overton&quot;</span><span class="op">,</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Elrond&quot;</span><span class="op">,</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    };</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> expected <span class="op">=</span> [_][]<span class="at">const</span> <span class="dt">u8</span>{</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Éloi&quot;</span><span class="op">,</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Elrond&quot;</span><span class="op">,</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Melissa&quot;</span><span class="op">,</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Mélissa&quot;</span><span class="op">,</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Ötzi&quot;</span><span class="op">,</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Overton&quot;</span><span class="op">,</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;چنگیز&quot;</span><span class="op">,</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;صدام&quot;</span><span class="op">,</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    };</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    std<span class="op">.</span>mem<span class="op">.</span>sort([]<span class="at">const</span> <span class="dt">u8</span><span class="op">,</span> <span class="op">&amp;</span>input<span class="op">,</span> <span class="op">&amp;</span>coll<span class="op">,</span> collateComparator);</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> std<span class="op">.</span>testing<span class="op">.</span>expectEqualSlices([]<span class="at">const</span> <span class="dt">u8</span><span class="op">,</span> <span class="op">&amp;</span>expected<span class="op">,</span> <span class="op">&amp;</span>input);</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>}</span></code></pre>
    </div>
  </body>
</html>
